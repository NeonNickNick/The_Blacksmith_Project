# 代码规范

本规范旨在在玩法规则尚不稳定的阶段限制提前抽象，防止以后修改困难。同时明确字段的所有权，缩小查 bug 时的工作量。
本规范的目标是降低早期技术风险，而非追求最优设计。所有规范都不是死的，经过讨论之后可以决定是否违反。
## 命名空间
1. <span style="color:red">根命名空间为 `namespace Blacksmith`。所有内容都要在这个命名空间下。</span>  
2. <span style="color:orange">禁止加子命名空间，除非经过讨论有明确的模块划分。</span>  
3. <span style="color:red">禁止 using 实际上没有用到的东西。</span>  

## 类
### 类
1. <span style="color:red">所有文件中不得出现类和全局枚举以外的内容。例如函数不能定义在类外面。</span>  
2. <span style="color:red">类必须是驼峰式命名，首字母大写。例如 `public class BlacksmithProject`。</span>  
3. <span style="color:red">禁止类嵌套超过1层。</span>  
4. <span style="color:orange">如果没有经过讨论，嵌套类必须是 private。</span>  
5. <span style="color:red">禁止继承超过2层，不计 Unity 提供的基类。</span>  
6. <span style="color:orange">除了存在明显本质身份关系的情况，尽量少用继承。</span>  
7. <span style="color:green">可以用 AI 来写类，但是必须清楚这个类的作用，同时满足所有的代码规范。</span>  

## MonoBehaviour
1. <span style="color:red">尽量采用 Awake + 自定义 Init 进行初始化。如果遇到初始化循环依赖要经过讨论解决。</span>  
2. <span style="color:red">游戏管理器（例如游戏生成器、玩家全局数据管理器）应该使用单例模式 `public Black Instance { get; private set; }`。</span>  
3. <span style="color:orange">对于拿不准的情况，例如不清楚各种 Update 有什么区别的时候，应该先讨论再继续。</span>  
4. <span style="color:red">MonoBehaviour 类初始会提供 Start 和 Update。如果不用的话必须删掉。</span>  
5. <span style="color:red">一个文件中只能有一个 MonoBehaviour 类，文件名必须和这个类名相同。允许有其他与这个 MonoBehaviour 关系紧密且近乎一一绑定关系的非 MonoBehaviour 类。</span>  

## ScriptableObject
1. <span style="color:red">配置数据（例如技能数值，或者依赖比较复杂的数据）都应该放在 ScriptableObject。</span>  
2. <span style="color:red">不在初始化以外的地方访问 ScriptableObject 字段。运行时对应 MonoBehaviour 类读取数据并拷贝，同时该类提供数据访问方法。</span>  

## 函数
1. <span style="color:red">必须是驼峰式命名，首字母大写。例如 `public void StartBlacksmithProject()`。</span>  
2. <span style="color:red">只有会被外部调用的函数是 public，其他必须是 private。</span>  
3. <span style="color:red">函数参数不得超过四个。</span>  
4. <span style="color:orange">禁止使用控制语句（如 if/else, while, for）超过一个的 lambda 函数。</span>  
5. <span style="color:orange">除了生命周期特别明确的情况，如果没有经过讨论，禁止从类外部启动协程。</span>  
6. <span style="color:red">外部可调用的函数禁止返回 tuple。</span>  
7. <span style="color:orange">需要谨慎考虑返回引用类型的函数，尤其是外部调用，所有权不明确时。</span>  
8. <span style="color:red">纯 C# 类构造函数中，如果成员构造依赖外部参数，必须在外部构造好再传入，而不是在构造函数里构造。</span>  
9. <span style="color:orange">除非特别特殊情况，不使用异常。</span>  
10. <span style="color:green">函数参数尽量使用首字母小写驼峰式命名，可根据 IDE 工具灵活处理，但必须能理解参数语义。</span>  
11. <span style="color:green">局部变量尽量使用首字母小写驼峰式命名。</span>  

## 字段
1. <span style="color:red">private 字段必须是下划线 + 驼峰式命名，例如 `_timesNewRoman`。</span>  
2. <span style="color:red">外部不查看字段全部为 private，外部要查看的 public 字段全部加 `{ get; private set; }` 属性。</span>  
3. <span style="color:red">属性首字母大写。</span>  
4. <span style="color:green">截至目前，私有字段下划线开头，公有字段首字母大写，函数首字母大写。</span>  
5. <span style="color:red">外部修改字段必须通过成员函数完成，而不是直接修改字段。</span>  

## 接口
1. <span style="color:red">除了显而易见的情况，如果没有经过讨论或抽象尚未明确，禁止自定义接口。</span>  

## 枚举
1. <span style="color:red">如果没有经过讨论，禁止使用全局枚举，必须定义在类中且为 private。</span>  
2. <span style="color:red">禁止枚举内枚举。</span>  
3. <span style="color:orange">技能相关枚举必须是下划线命名，首字母大写。例如 `Type.Class5_Sbs_Wangs`。</span>  

## 注释
1. <span style="color:green">如果复杂，应在注释中详细解释思路。</span>  
2. <span style="color:green">允许解释字段和函数是什么，但尽量简洁。</span>  
3. <span style="color:green">允许解释某个语句在做什么，特别是有小巧思时。</span>  

## 委托
1. <span style="color:orange">如果不确定生命周期，尽量不要主动使用函数委托。</span>  

## 日志
1. <span style="color:red">禁止随意 Debug.Log 打印日志，除非用于验证是否正确运行。</span>  
2. <span style="color:red">除非常特殊情况，禁止在 Update 中打印日志。</span>  
3. <span style="color:orange">功能完成后，可以注释或删除日志，对排查有价值的日志允许保留并说明用途。</span>  
